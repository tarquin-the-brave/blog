
<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom">
 <channel>
   <title>Tags on tarquin-the-brave</title>
   <link>https://tarquin-the-brave.github.io/blog/tags/</link>
   <description>Recent content in Tags on tarquin-the-brave</description>
   <generator>Hugo -- gohugo.io</generator>
   <copyright>Copyright &amp;copy; 2020 - Tom Steavenson</copyright>
   
       <atom:link href="https://tarquin-the-brave.github.io/blog/tags/index.xml" rel="self" type="application/rss+xml" />
   
   
     <item>
       <title>Rust - Converting between file formats - JSON, YAML, &amp; TOML</title>
       <link>https://tarquin-the-brave.github.io/blog/posts/rust-serde/</link>
       <pubDate>Thu, 26 Mar 2020 21:00:00 +0000</pubDate>
       
       <guid>https://tarquin-the-brave.github.io/blog/posts/rust-serde/</guid>
       <description>&lt;p&gt;Rust&amp;rsquo;s &lt;a href=&#34;https://crates.io/crates/serde&#34;&gt;&lt;code&gt;serde&lt;/code&gt; library&lt;/a&gt; is a generic serialize-deserialize framework
that has been implemented for &lt;a href=&#34;https://docs.serde.rs/serde/#data-formats&#34;&gt;many file formats&lt;/a&gt;.  It&amp;rsquo;s&lt;/p&gt;
&lt;p&gt;an incredibly powerful framework and well worth giving &lt;a href=&#34;https://docs.serde.rs/serde/&#34;&gt;the
documentation&lt;/a&gt; a read.&lt;/p&gt;
&lt;p&gt;It can deserialize a file format into a strongly typed rust data structure, so
that the data in code has no affiliation to the data format it was read from,
then can be serialized into another file format.&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-rust&#34; data-lang=&#34;rust&#34;&gt;&lt;span style=&#34;color:#75715e&#34;&gt;#![&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;allow(unused_variables)&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;]&lt;/span&gt;
&lt;span style=&#34;color:#66d9ef&#34;&gt;use&lt;/span&gt; serde_derive::{Deserialize, Serialize};

&lt;span style=&#34;color:#75715e&#34;&gt;#[&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;derive(Serialize, Deserialize, Debug, Clone, PartialEq)&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;]&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;#[&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;serde(rename_all = &lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;camelCase&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;, deny_unknown_fields)&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;]&lt;/span&gt;
&lt;span style=&#34;color:#66d9ef&#34;&gt;struct&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;MyData&lt;/span&gt; {
    field_one: &lt;span style=&#34;color:#66d9ef&#34;&gt;usize&lt;/span&gt;,
    field_two: String,
    field_three: &lt;span style=&#34;color:#66d9ef&#34;&gt;bool&lt;/span&gt;,
    some_data: &lt;span style=&#34;color:#a6e22e&#34;&gt;std&lt;/span&gt;::collections::HashMap&lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;&lt;/span&gt;String, &lt;span style=&#34;color:#66d9ef&#34;&gt;usize&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;&amp;gt;&lt;/span&gt;,
}

&lt;span style=&#34;color:#66d9ef&#34;&gt;fn&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;main&lt;/span&gt;() -&amp;gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;anyhow&lt;/span&gt;::Result&lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;&lt;/span&gt;()&lt;span style=&#34;color:#f92672&#34;&gt;&amp;gt;&lt;/span&gt; {
    &lt;span style=&#34;color:#66d9ef&#34;&gt;let&lt;/span&gt; my_data_yaml &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; r&lt;span style=&#34;color:#960050;background-color:#1e0010&#34;&gt;#&lt;/span&gt;&lt;span style=&#34;color:#960050;background-color:#1e0010&#34;&gt;&amp;#34;&lt;/span&gt;
        fieldOne: &lt;span style=&#34;color:#ae81ff&#34;&gt;7&lt;/span&gt;
        fieldTwo: &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;lorem&amp;#34;&lt;/span&gt;
        fieldThree: &lt;span style=&#34;color:#a6e22e&#34;&gt;true&lt;/span&gt;
        someData:
            &lt;span style=&#34;color:#a6e22e&#34;&gt;x&lt;/span&gt;: &lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt;
            y: &lt;span style=&#34;color:#ae81ff&#34;&gt;2&lt;/span&gt;
            z: &lt;span style=&#34;color:#ae81ff&#34;&gt;3&lt;/span&gt;
        &lt;span style=&#34;color:#960050;background-color:#1e0010&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color:#960050;background-color:#1e0010&#34;&gt;#&lt;/span&gt;;

    &lt;span style=&#34;color:#66d9ef&#34;&gt;let&lt;/span&gt; my_data_toml &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; r&lt;span style=&#34;color:#960050;background-color:#1e0010&#34;&gt;#&lt;/span&gt;&lt;span style=&#34;color:#960050;background-color:#1e0010&#34;&gt;&amp;#34;&lt;/span&gt;
        fieldOne &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;7&lt;/span&gt;
        fieldTwo &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;lorem&amp;#34;&lt;/span&gt;
        fieldThree &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;true&lt;/span&gt;

        [someData]
        x &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt;
        y &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;2&lt;/span&gt;
        z &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;3&lt;/span&gt;
        &lt;span style=&#34;color:#960050;background-color:#1e0010&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color:#960050;background-color:#1e0010&#34;&gt;#&lt;/span&gt;;

    &lt;span style=&#34;color:#66d9ef&#34;&gt;let&lt;/span&gt; my_data_json &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; r&lt;span style=&#34;color:#960050;background-color:#1e0010&#34;&gt;#&lt;/span&gt;&lt;span style=&#34;color:#960050;background-color:#1e0010&#34;&gt;&amp;#34;&lt;/span&gt;
        {
          &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;fieldOne&amp;#34;&lt;/span&gt;: &lt;span style=&#34;color:#ae81ff&#34;&gt;7&lt;/span&gt;,
          &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;fieldTwo&amp;#34;&lt;/span&gt;: &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;lorem&amp;#34;&lt;/span&gt;,
          &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;fieldThree&amp;#34;&lt;/span&gt;: &lt;span style=&#34;color:#a6e22e&#34;&gt;true&lt;/span&gt;,
          &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;someData&amp;#34;&lt;/span&gt;: {
            &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;x&amp;#34;&lt;/span&gt;: &lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt;,
            &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;y&amp;#34;&lt;/span&gt;: &lt;span style=&#34;color:#ae81ff&#34;&gt;2&lt;/span&gt;,
            &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;z&amp;#34;&lt;/span&gt;: &lt;span style=&#34;color:#ae81ff&#34;&gt;3&lt;/span&gt;
          }
        }
        &lt;span style=&#34;color:#960050;background-color:#1e0010&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color:#960050;background-color:#1e0010&#34;&gt;#&lt;/span&gt;;

    &lt;span style=&#34;color:#66d9ef&#34;&gt;let&lt;/span&gt; deserialized_yaml &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; serde_yaml::from_str::&lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;&lt;/span&gt;MyData&lt;span style=&#34;color:#f92672&#34;&gt;&amp;gt;&lt;/span&gt;(my_data_yaml);
    &lt;span style=&#34;color:#66d9ef&#34;&gt;let&lt;/span&gt; deserialized_toml &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; toml::from_str::&lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;&lt;/span&gt;MyData&lt;span style=&#34;color:#f92672&#34;&gt;&amp;gt;&lt;/span&gt;(my_data_toml);
    &lt;span style=&#34;color:#66d9ef&#34;&gt;let&lt;/span&gt; deserialized_json &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; serde_json::from_str::&lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;&lt;/span&gt;MyData&lt;span style=&#34;color:#f92672&#34;&gt;&amp;gt;&lt;/span&gt;(my_data_json);

    assert&lt;span style=&#34;color:#f92672&#34;&gt;!&lt;/span&gt;(deserialized_yaml.is_ok());
    assert&lt;span style=&#34;color:#f92672&#34;&gt;!&lt;/span&gt;(deserialized_toml.is_ok());
    assert&lt;span style=&#34;color:#f92672&#34;&gt;!&lt;/span&gt;(deserialized_json.is_ok());

    &lt;span style=&#34;color:#66d9ef&#34;&gt;let&lt;/span&gt; deserialized_toml_copy &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; deserialized_toml.clone();

    assert_eq&lt;span style=&#34;color:#f92672&#34;&gt;!&lt;/span&gt;(deserialized_yaml&lt;span style=&#34;color:#f92672&#34;&gt;?&lt;/span&gt;, deserialized_toml&lt;span style=&#34;color:#f92672&#34;&gt;?&lt;/span&gt;);
    assert_eq&lt;span style=&#34;color:#f92672&#34;&gt;!&lt;/span&gt;(deserialized_toml_copy&lt;span style=&#34;color:#f92672&#34;&gt;?&lt;/span&gt;, deserialized_json&lt;span style=&#34;color:#f92672&#34;&gt;?&lt;/span&gt;);

    &lt;span style=&#34;color:#66d9ef&#34;&gt;let&lt;/span&gt; my_data_yaml_missing_field &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; r&lt;span style=&#34;color:#960050;background-color:#1e0010&#34;&gt;#&lt;/span&gt;&lt;span style=&#34;color:#960050;background-color:#1e0010&#34;&gt;&amp;#34;&lt;/span&gt;
        fieldOne: &lt;span style=&#34;color:#ae81ff&#34;&gt;7&lt;/span&gt;
        fieldTwo: &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;lorem&amp;#34;&lt;/span&gt;
        someData:
            &lt;span style=&#34;color:#a6e22e&#34;&gt;x&lt;/span&gt;: &lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt;
            y: &lt;span style=&#34;color:#ae81ff&#34;&gt;2&lt;/span&gt;
            z: &lt;span style=&#34;color:#ae81ff&#34;&gt;3&lt;/span&gt;
        &lt;span style=&#34;color:#960050;background-color:#1e0010&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color:#960050;background-color:#1e0010&#34;&gt;#&lt;/span&gt;;

    &lt;span style=&#34;color:#66d9ef&#34;&gt;let&lt;/span&gt; my_data_yaml_extra_field &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; r&lt;span style=&#34;color:#960050;background-color:#1e0010&#34;&gt;#&lt;/span&gt;&lt;span style=&#34;color:#960050;background-color:#1e0010&#34;&gt;&amp;#34;&lt;/span&gt;
        fieldOne: &lt;span style=&#34;color:#ae81ff&#34;&gt;7&lt;/span&gt;
        fieldTwo: &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;lorem&amp;#34;&lt;/span&gt;
        fieldThree: &lt;span style=&#34;color:#a6e22e&#34;&gt;true&lt;/span&gt;
        someData:
            &lt;span style=&#34;color:#a6e22e&#34;&gt;x&lt;/span&gt;: &lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt;
            y: &lt;span style=&#34;color:#ae81ff&#34;&gt;2&lt;/span&gt;
            z: &lt;span style=&#34;color:#ae81ff&#34;&gt;3&lt;/span&gt;
        out_of_schema_data: &lt;span style=&#34;color:#ae81ff&#34;&gt;42&lt;/span&gt;
        &lt;span style=&#34;color:#960050;background-color:#1e0010&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color:#960050;background-color:#1e0010&#34;&gt;#&lt;/span&gt;;

    &lt;span style=&#34;color:#66d9ef&#34;&gt;let&lt;/span&gt; data_missing_field &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; serde_yaml::from_str::&lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;&lt;/span&gt;MyData&lt;span style=&#34;color:#f92672&#34;&gt;&amp;gt;&lt;/span&gt;(my_data_yaml_missing_field);
    &lt;span style=&#34;color:#66d9ef&#34;&gt;let&lt;/span&gt; data_extra_field &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; serde_yaml::from_str::&lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;&lt;/span&gt;MyData&lt;span style=&#34;color:#f92672&#34;&gt;&amp;gt;&lt;/span&gt;(my_data_yaml_extra_field);

    assert&lt;span style=&#34;color:#f92672&#34;&gt;!&lt;/span&gt;(data_missing_field.is_err());
    &lt;span style=&#34;color:#75715e&#34;&gt;// Because MyData is decorated with `deny_unknown_fields`, adding extra fields
&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;    &lt;span style=&#34;color:#75715e&#34;&gt;// will cause parsing to fail.
&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;    assert&lt;span style=&#34;color:#f92672&#34;&gt;!&lt;/span&gt;(data_extra_field.is_err());

    Ok(())
}
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;You can also read data into a type that can represent any data in a particular
format, if you don&amp;rsquo;t want to or can&amp;rsquo;t strongly define the contents:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-rust&#34; data-lang=&#34;rust&#34;&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;let&lt;/span&gt; yaml_data &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; serde_yaml::from_str::&lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;&lt;/span&gt;serde_yaml::Value&lt;span style=&#34;color:#f92672&#34;&gt;&amp;gt;&lt;/span&gt;(my_data_yaml)&lt;span style=&#34;color:#f92672&#34;&gt;?&lt;/span&gt;;
&lt;span style=&#34;color:#66d9ef&#34;&gt;let&lt;/span&gt; toml_data &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; toml::from_str::&lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;&lt;/span&gt;toml::Value&lt;span style=&#34;color:#f92672&#34;&gt;&amp;gt;&lt;/span&gt;(my_data_toml)&lt;span style=&#34;color:#f92672&#34;&gt;?&lt;/span&gt;;
&lt;span style=&#34;color:#66d9ef&#34;&gt;let&lt;/span&gt; json_data &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; serde_json::from_str::&lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;&lt;/span&gt;serde_json::Value&lt;span style=&#34;color:#f92672&#34;&gt;&amp;gt;&lt;/span&gt;(my_data_json)&lt;span style=&#34;color:#f92672&#34;&gt;?&lt;/span&gt;;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;Recently I&amp;rsquo;ve found that it&amp;rsquo;s even able to deserialize a type that&amp;rsquo;s supposed
to represent one format straight into another, and conversely can serialize a
type for a certain format into another.  For JSON, YAML, and TOML formats there
are the types &lt;a href=&#34;https://docs.serde.rs/serde_json/enum.Value.html&#34;&gt;&lt;code&gt;serde_json::Value&lt;/code&gt;&lt;/a&gt;, &lt;a href=&#34;https://docs.rs/serde_yaml/0.8.11/serde_yaml/enum.Value.html&#34;&gt;&lt;code&gt;serde_yaml::Value&lt;/code&gt;&lt;/a&gt;, and
&lt;a href=&#34;https://docs.rs/toml/0.5.6/toml/value/enum.Value.html&#34;&gt;&lt;code&gt;toml::Value&lt;/code&gt;&lt;/a&gt; which represent any data in their respective formats and
can used to deserialize data when we can&amp;rsquo;t or don&amp;rsquo;t want to define the precise
structure of the data.  It turns out you can read a file format straight into
one of these other types.&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-rust&#34; data-lang=&#34;rust&#34;&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;let&lt;/span&gt; toml_from_yaml &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; serde_yaml::from_str::&lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;&lt;/span&gt;toml::Value&lt;span style=&#34;color:#f92672&#34;&gt;&amp;gt;&lt;/span&gt;(my_data_yaml)&lt;span style=&#34;color:#f92672&#34;&gt;?&lt;/span&gt;;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;It might be that this conversion fails and the data is not readable into the
other format&amp;rsquo;s &lt;code&gt;Value&lt;/code&gt;, and you&amp;rsquo;ll get a &lt;code&gt;Err&lt;/code&gt;. E.g:
&lt;a href=&#34;https://docs.rs/serde_yaml/0.8.11/src/serde_yaml/mapping.rs.html#10-12&#34;&gt;&lt;code&gt;serde_yaml::Mapping&lt;/code&gt;&lt;/a&gt; allows keys of any variant of &lt;a href=&#34;https://docs.rs/serde_yaml/0.8.11/serde_yaml/enum.Value.html&#34;&gt;&lt;code&gt;Value&lt;/code&gt;&lt;/a&gt;,
however &lt;a href=&#34;https://docs.serde.rs/serde_json/map/struct.Map.html&#34;&gt;&lt;code&gt;serde_json:🗺:Map&lt;/code&gt;&lt;/a&gt; is only implemented with &lt;code&gt;String&lt;/code&gt; as a key
type:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-rust&#34; data-lang=&#34;rust&#34;&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;let&lt;/span&gt; some_yaml &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; r&lt;span style=&#34;color:#960050;background-color:#1e0010&#34;&gt;#&lt;/span&gt;&lt;span style=&#34;color:#960050;background-color:#1e0010&#34;&gt;&amp;#34;&lt;/span&gt;
    [&lt;span style=&#34;color:#ae81ff&#34;&gt;5&lt;/span&gt;,&lt;span style=&#34;color:#ae81ff&#34;&gt;6&lt;/span&gt;]: &lt;span style=&#34;color:#a6e22e&#34;&gt;true&lt;/span&gt;
    &lt;span style=&#34;color:#960050;background-color:#1e0010&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color:#960050;background-color:#1e0010&#34;&gt;#&lt;/span&gt;;

&lt;span style=&#34;color:#66d9ef&#34;&gt;let&lt;/span&gt; try_yaml &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; serde_yaml::from_str::&lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;&lt;/span&gt;serde_yaml::Value&lt;span style=&#34;color:#f92672&#34;&gt;&amp;gt;&lt;/span&gt;(some_yaml);
&lt;span style=&#34;color:#66d9ef&#34;&gt;let&lt;/span&gt; try_json &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; serde_yaml::from_str::&lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;&lt;/span&gt;serde_json::Value&lt;span style=&#34;color:#f92672&#34;&gt;&amp;gt;&lt;/span&gt;(some_yaml);

assert&lt;span style=&#34;color:#f92672&#34;&gt;!&lt;/span&gt;(try_yaml.is_ok());
assert&lt;span style=&#34;color:#f92672&#34;&gt;!&lt;/span&gt;(try_json.is_err());
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;This actually has real practical implication.  JSON, for example, is far less
human friendly than either YAML or TOML.  There are libraries, packed with
useful functionality that intend to receive data in a certain format.  Serde&amp;rsquo;s
design decouples this.  &lt;a href=&#34;https://json-schema.org/&#34;&gt;JSON Schema&lt;/a&gt; is an example.  It&amp;rsquo;s a richly
featured schema implementation.  But usually you have to write your schemas in
JSON. &lt;a href=&#34;https://jsonschema.net/home&#34;&gt;JSON Schema Tool&lt;/a&gt; is an online tool that will generate a inferred
schema from some example JSON.  Using the example given when you visit the
page: this JSON:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-json&#34; data-lang=&#34;json&#34;&gt;{
    &lt;span style=&#34;color:#f92672&#34;&gt;&amp;#34;checked&amp;#34;&lt;/span&gt;: &lt;span style=&#34;color:#66d9ef&#34;&gt;false&lt;/span&gt;,
    &lt;span style=&#34;color:#f92672&#34;&gt;&amp;#34;dimensions&amp;#34;&lt;/span&gt;: {
        &lt;span style=&#34;color:#f92672&#34;&gt;&amp;#34;width&amp;#34;&lt;/span&gt;: &lt;span style=&#34;color:#ae81ff&#34;&gt;5&lt;/span&gt;,
        &lt;span style=&#34;color:#f92672&#34;&gt;&amp;#34;height&amp;#34;&lt;/span&gt;: &lt;span style=&#34;color:#ae81ff&#34;&gt;10&lt;/span&gt;
    },
    &lt;span style=&#34;color:#f92672&#34;&gt;&amp;#34;id&amp;#34;&lt;/span&gt;: &lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt;,
    &lt;span style=&#34;color:#f92672&#34;&gt;&amp;#34;name&amp;#34;&lt;/span&gt;: &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;A green door&amp;#34;&lt;/span&gt;,
    &lt;span style=&#34;color:#f92672&#34;&gt;&amp;#34;price&amp;#34;&lt;/span&gt;: &lt;span style=&#34;color:#ae81ff&#34;&gt;12.5&lt;/span&gt;,
    &lt;span style=&#34;color:#f92672&#34;&gt;&amp;#34;tags&amp;#34;&lt;/span&gt;: [
        &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;home&amp;#34;&lt;/span&gt;,
        &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;green&amp;#34;&lt;/span&gt;
    ]
}
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;, generates this schema:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-json&#34; data-lang=&#34;json&#34;&gt;{
    &lt;span style=&#34;color:#f92672&#34;&gt;&amp;#34;$schema&amp;#34;&lt;/span&gt;: &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;http://json-schema.org/draft-07/schema&amp;#34;&lt;/span&gt;,
    &lt;span style=&#34;color:#f92672&#34;&gt;&amp;#34;$id&amp;#34;&lt;/span&gt;: &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;http://example.com/root.json&amp;#34;&lt;/span&gt;,
    &lt;span style=&#34;color:#f92672&#34;&gt;&amp;#34;type&amp;#34;&lt;/span&gt;: &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;object&amp;#34;&lt;/span&gt;,
    &lt;span style=&#34;color:#f92672&#34;&gt;&amp;#34;title&amp;#34;&lt;/span&gt;: &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;The Root Schema&amp;#34;&lt;/span&gt;,
    &lt;span style=&#34;color:#f92672&#34;&gt;&amp;#34;description&amp;#34;&lt;/span&gt;: &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;The root schema is the schema that comprises the entire JSON document.&amp;#34;&lt;/span&gt;,
    &lt;span style=&#34;color:#f92672&#34;&gt;&amp;#34;default&amp;#34;&lt;/span&gt;: {},
    &lt;span style=&#34;color:#f92672&#34;&gt;&amp;#34;required&amp;#34;&lt;/span&gt;: [
        &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;checked&amp;#34;&lt;/span&gt;,
        &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;dimensions&amp;#34;&lt;/span&gt;,
        &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;id&amp;#34;&lt;/span&gt;,
        &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;name&amp;#34;&lt;/span&gt;,
        &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;price&amp;#34;&lt;/span&gt;,
        &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;tags&amp;#34;&lt;/span&gt;
    ],
    &lt;span style=&#34;color:#f92672&#34;&gt;&amp;#34;properties&amp;#34;&lt;/span&gt;: {
        &lt;span style=&#34;color:#f92672&#34;&gt;&amp;#34;checked&amp;#34;&lt;/span&gt;: {
            &lt;span style=&#34;color:#f92672&#34;&gt;&amp;#34;$id&amp;#34;&lt;/span&gt;: &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;#/properties/checked&amp;#34;&lt;/span&gt;,
            &lt;span style=&#34;color:#f92672&#34;&gt;&amp;#34;type&amp;#34;&lt;/span&gt;: &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;boolean&amp;#34;&lt;/span&gt;,
            &lt;span style=&#34;color:#f92672&#34;&gt;&amp;#34;title&amp;#34;&lt;/span&gt;: &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;The Checked Schema&amp;#34;&lt;/span&gt;,
            &lt;span style=&#34;color:#f92672&#34;&gt;&amp;#34;description&amp;#34;&lt;/span&gt;: &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;An explanation about the purpose of this instance.&amp;#34;&lt;/span&gt;,
            &lt;span style=&#34;color:#f92672&#34;&gt;&amp;#34;default&amp;#34;&lt;/span&gt;: &lt;span style=&#34;color:#66d9ef&#34;&gt;false&lt;/span&gt;,
            &lt;span style=&#34;color:#f92672&#34;&gt;&amp;#34;examples&amp;#34;&lt;/span&gt;: [
                &lt;span style=&#34;color:#66d9ef&#34;&gt;false&lt;/span&gt;
            ]
        },
        &lt;span style=&#34;color:#f92672&#34;&gt;&amp;#34;dimensions&amp;#34;&lt;/span&gt;: {
            &lt;span style=&#34;color:#f92672&#34;&gt;&amp;#34;$id&amp;#34;&lt;/span&gt;: &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;#/properties/dimensions&amp;#34;&lt;/span&gt;,
            &lt;span style=&#34;color:#f92672&#34;&gt;&amp;#34;type&amp;#34;&lt;/span&gt;: &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;object&amp;#34;&lt;/span&gt;,
            &lt;span style=&#34;color:#f92672&#34;&gt;&amp;#34;title&amp;#34;&lt;/span&gt;: &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;The Dimensions Schema&amp;#34;&lt;/span&gt;,
            &lt;span style=&#34;color:#f92672&#34;&gt;&amp;#34;description&amp;#34;&lt;/span&gt;: &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;An explanation about the purpose of this instance.&amp;#34;&lt;/span&gt;,
            &lt;span style=&#34;color:#f92672&#34;&gt;&amp;#34;default&amp;#34;&lt;/span&gt;: {},
            &lt;span style=&#34;color:#f92672&#34;&gt;&amp;#34;examples&amp;#34;&lt;/span&gt;: [
                {
                    &lt;span style=&#34;color:#f92672&#34;&gt;&amp;#34;height&amp;#34;&lt;/span&gt;: &lt;span style=&#34;color:#ae81ff&#34;&gt;10.0&lt;/span&gt;,
                    &lt;span style=&#34;color:#f92672&#34;&gt;&amp;#34;width&amp;#34;&lt;/span&gt;: &lt;span style=&#34;color:#ae81ff&#34;&gt;5.0&lt;/span&gt;
                }
            ],
            &lt;span style=&#34;color:#f92672&#34;&gt;&amp;#34;required&amp;#34;&lt;/span&gt;: [
                &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;width&amp;#34;&lt;/span&gt;,
                &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;height&amp;#34;&lt;/span&gt;
            ],
            &lt;span style=&#34;color:#f92672&#34;&gt;&amp;#34;properties&amp;#34;&lt;/span&gt;: {
                &lt;span style=&#34;color:#f92672&#34;&gt;&amp;#34;width&amp;#34;&lt;/span&gt;: {
                    &lt;span style=&#34;color:#f92672&#34;&gt;&amp;#34;$id&amp;#34;&lt;/span&gt;: &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;#/properties/dimensions/properties/width&amp;#34;&lt;/span&gt;,
                    &lt;span style=&#34;color:#f92672&#34;&gt;&amp;#34;type&amp;#34;&lt;/span&gt;: &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;integer&amp;#34;&lt;/span&gt;,
                    &lt;span style=&#34;color:#f92672&#34;&gt;&amp;#34;title&amp;#34;&lt;/span&gt;: &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;The Width Schema&amp;#34;&lt;/span&gt;,
                    &lt;span style=&#34;color:#f92672&#34;&gt;&amp;#34;description&amp;#34;&lt;/span&gt;: &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;An explanation about the purpose of this instance.&amp;#34;&lt;/span&gt;,
                    &lt;span style=&#34;color:#f92672&#34;&gt;&amp;#34;default&amp;#34;&lt;/span&gt;: &lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;,
                    &lt;span style=&#34;color:#f92672&#34;&gt;&amp;#34;examples&amp;#34;&lt;/span&gt;: [
                        &lt;span style=&#34;color:#ae81ff&#34;&gt;5&lt;/span&gt;
                    ]
                },
                &lt;span style=&#34;color:#f92672&#34;&gt;&amp;#34;height&amp;#34;&lt;/span&gt;: {
                    &lt;span style=&#34;color:#f92672&#34;&gt;&amp;#34;$id&amp;#34;&lt;/span&gt;: &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;#/properties/dimensions/properties/height&amp;#34;&lt;/span&gt;,
                    &lt;span style=&#34;color:#f92672&#34;&gt;&amp;#34;type&amp;#34;&lt;/span&gt;: &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;integer&amp;#34;&lt;/span&gt;,
                    &lt;span style=&#34;color:#f92672&#34;&gt;&amp;#34;title&amp;#34;&lt;/span&gt;: &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;The Height Schema&amp;#34;&lt;/span&gt;,
                    &lt;span style=&#34;color:#f92672&#34;&gt;&amp;#34;description&amp;#34;&lt;/span&gt;: &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;An explanation about the purpose of this instance.&amp;#34;&lt;/span&gt;,
                    &lt;span style=&#34;color:#f92672&#34;&gt;&amp;#34;default&amp;#34;&lt;/span&gt;: &lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;,
                    &lt;span style=&#34;color:#f92672&#34;&gt;&amp;#34;examples&amp;#34;&lt;/span&gt;: [
                        &lt;span style=&#34;color:#ae81ff&#34;&gt;10&lt;/span&gt;
                    ]
                }
            }
        },
        &lt;span style=&#34;color:#f92672&#34;&gt;&amp;#34;id&amp;#34;&lt;/span&gt;: {
            &lt;span style=&#34;color:#f92672&#34;&gt;&amp;#34;$id&amp;#34;&lt;/span&gt;: &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;#/properties/id&amp;#34;&lt;/span&gt;,
            &lt;span style=&#34;color:#f92672&#34;&gt;&amp;#34;type&amp;#34;&lt;/span&gt;: &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;integer&amp;#34;&lt;/span&gt;,
            &lt;span style=&#34;color:#f92672&#34;&gt;&amp;#34;title&amp;#34;&lt;/span&gt;: &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;The Id Schema&amp;#34;&lt;/span&gt;,
            &lt;span style=&#34;color:#f92672&#34;&gt;&amp;#34;description&amp;#34;&lt;/span&gt;: &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;An explanation about the purpose of this instance.&amp;#34;&lt;/span&gt;,
            &lt;span style=&#34;color:#f92672&#34;&gt;&amp;#34;default&amp;#34;&lt;/span&gt;: &lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;,
            &lt;span style=&#34;color:#f92672&#34;&gt;&amp;#34;examples&amp;#34;&lt;/span&gt;: [
                &lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt;
            ]
        },
        &lt;span style=&#34;color:#f92672&#34;&gt;&amp;#34;name&amp;#34;&lt;/span&gt;: {
            &lt;span style=&#34;color:#f92672&#34;&gt;&amp;#34;$id&amp;#34;&lt;/span&gt;: &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;#/properties/name&amp;#34;&lt;/span&gt;,
            &lt;span style=&#34;color:#f92672&#34;&gt;&amp;#34;type&amp;#34;&lt;/span&gt;: &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;string&amp;#34;&lt;/span&gt;,
            &lt;span style=&#34;color:#f92672&#34;&gt;&amp;#34;title&amp;#34;&lt;/span&gt;: &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;The Name Schema&amp;#34;&lt;/span&gt;,
            &lt;span style=&#34;color:#f92672&#34;&gt;&amp;#34;description&amp;#34;&lt;/span&gt;: &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;An explanation about the purpose of this instance.&amp;#34;&lt;/span&gt;,
            &lt;span style=&#34;color:#f92672&#34;&gt;&amp;#34;default&amp;#34;&lt;/span&gt;: &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;&amp;#34;&lt;/span&gt;,
            &lt;span style=&#34;color:#f92672&#34;&gt;&amp;#34;examples&amp;#34;&lt;/span&gt;: [
                &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;A green door&amp;#34;&lt;/span&gt;
            ]
        },
        &lt;span style=&#34;color:#f92672&#34;&gt;&amp;#34;price&amp;#34;&lt;/span&gt;: {
            &lt;span style=&#34;color:#f92672&#34;&gt;&amp;#34;$id&amp;#34;&lt;/span&gt;: &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;#/properties/price&amp;#34;&lt;/span&gt;,
            &lt;span style=&#34;color:#f92672&#34;&gt;&amp;#34;type&amp;#34;&lt;/span&gt;: &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;number&amp;#34;&lt;/span&gt;,
            &lt;span style=&#34;color:#f92672&#34;&gt;&amp;#34;title&amp;#34;&lt;/span&gt;: &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;The Price Schema&amp;#34;&lt;/span&gt;,
            &lt;span style=&#34;color:#f92672&#34;&gt;&amp;#34;description&amp;#34;&lt;/span&gt;: &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;An explanation about the purpose of this instance.&amp;#34;&lt;/span&gt;,
            &lt;span style=&#34;color:#f92672&#34;&gt;&amp;#34;default&amp;#34;&lt;/span&gt;: &lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;,
            &lt;span style=&#34;color:#f92672&#34;&gt;&amp;#34;examples&amp;#34;&lt;/span&gt;: [
                &lt;span style=&#34;color:#ae81ff&#34;&gt;12.5&lt;/span&gt;
            ]
        },
        &lt;span style=&#34;color:#f92672&#34;&gt;&amp;#34;tags&amp;#34;&lt;/span&gt;: {
            &lt;span style=&#34;color:#f92672&#34;&gt;&amp;#34;$id&amp;#34;&lt;/span&gt;: &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;#/properties/tags&amp;#34;&lt;/span&gt;,
            &lt;span style=&#34;color:#f92672&#34;&gt;&amp;#34;type&amp;#34;&lt;/span&gt;: &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;array&amp;#34;&lt;/span&gt;,
            &lt;span style=&#34;color:#f92672&#34;&gt;&amp;#34;title&amp;#34;&lt;/span&gt;: &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;The Tags Schema&amp;#34;&lt;/span&gt;,
            &lt;span style=&#34;color:#f92672&#34;&gt;&amp;#34;description&amp;#34;&lt;/span&gt;: &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;An explanation about the purpose of this instance.&amp;#34;&lt;/span&gt;,
            &lt;span style=&#34;color:#f92672&#34;&gt;&amp;#34;default&amp;#34;&lt;/span&gt;: [],
            &lt;span style=&#34;color:#f92672&#34;&gt;&amp;#34;examples&amp;#34;&lt;/span&gt;: [
                [
                    &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;home&amp;#34;&lt;/span&gt;,
                    &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;green&amp;#34;&lt;/span&gt;
                ]
            ],
            &lt;span style=&#34;color:#f92672&#34;&gt;&amp;#34;items&amp;#34;&lt;/span&gt;: {
                &lt;span style=&#34;color:#f92672&#34;&gt;&amp;#34;$id&amp;#34;&lt;/span&gt;: &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;#/properties/tags/items&amp;#34;&lt;/span&gt;,
                &lt;span style=&#34;color:#f92672&#34;&gt;&amp;#34;type&amp;#34;&lt;/span&gt;: &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;string&amp;#34;&lt;/span&gt;,
                &lt;span style=&#34;color:#f92672&#34;&gt;&amp;#34;title&amp;#34;&lt;/span&gt;: &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;The Items Schema&amp;#34;&lt;/span&gt;,
                &lt;span style=&#34;color:#f92672&#34;&gt;&amp;#34;description&amp;#34;&lt;/span&gt;: &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;An explanation about the purpose of this instance.&amp;#34;&lt;/span&gt;,
                &lt;span style=&#34;color:#f92672&#34;&gt;&amp;#34;default&amp;#34;&lt;/span&gt;: &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;&amp;#34;&lt;/span&gt;,
                &lt;span style=&#34;color:#f92672&#34;&gt;&amp;#34;examples&amp;#34;&lt;/span&gt;: [
                    &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;home&amp;#34;&lt;/span&gt;,
                    &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;green&amp;#34;&lt;/span&gt;
                ]
            }
        }
    }
}
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;You could imagine that you might want to expand that schema even further with
defauts, examples and other rules constraining the values of some fields.&lt;/p&gt;
&lt;p&gt;Rust has a library &lt;a href=&#34;https://docs.rs/schemars/0.7.0/schemars/&#34;&gt;&lt;code&gt;schemars&lt;/code&gt;&lt;/a&gt; that implements JSON Schema. While the
documentation goes through examples of &lt;a href=&#34;https://docs.rs/schemars/0.7.0/schemars/#serde-compatibility&#34;&gt;defining schemas in code&lt;/a&gt;, and
serializing with &lt;code&gt;serde_json&lt;/code&gt;, you can read a &lt;a href=&#34;https://docs.rs/schemars/0.7.0/schemars/schema/struct.SchemaObject.html&#34;&gt;&lt;code&gt;SchemaObject&lt;/code&gt;&lt;/a&gt; straight
from YAML, or TOML.  So your application can leverage the functionality of the
&lt;code&gt;SchemaObject&lt;/code&gt; and the &lt;code&gt;schemars&lt;/code&gt; library while getting users write schemas in
a more human readable form.&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-rust&#34; data-lang=&#34;rust&#34;&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;let&lt;/span&gt; json_schema &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; serde_json::from_str::&lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;&lt;/span&gt;schemars::schema::RootSchema&lt;span style=&#34;color:#f92672&#34;&gt;&amp;gt;&lt;/span&gt;(
    &lt;span style=&#34;color:#f92672&#34;&gt;&amp;amp;&lt;/span&gt;std::fs::read_to_string(&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;example.schema.json&amp;#34;&lt;/span&gt;)&lt;span style=&#34;color:#f92672&#34;&gt;?&lt;/span&gt;,
)&lt;span style=&#34;color:#f92672&#34;&gt;?&lt;/span&gt;;

&lt;span style=&#34;color:#66d9ef&#34;&gt;let&lt;/span&gt; json_schema_from_yaml &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; serde_yaml::from_str::&lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;&lt;/span&gt;schemars::schema::RootSchema&lt;span style=&#34;color:#f92672&#34;&gt;&amp;gt;&lt;/span&gt;(
    &lt;span style=&#34;color:#f92672&#34;&gt;&amp;amp;&lt;/span&gt;std::fs::read_to_string(&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;example.schema.yaml&amp;#34;&lt;/span&gt;)&lt;span style=&#34;color:#f92672&#34;&gt;?&lt;/span&gt;,
)&lt;span style=&#34;color:#f92672&#34;&gt;?&lt;/span&gt;;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;The same JSON Schema from above is much more readable when written in YAML:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-yaml&#34; data-lang=&#34;yaml&#34;&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;$schema&lt;/span&gt;: http://json-schema.org/draft&lt;span style=&#34;color:#ae81ff&#34;&gt;-07&lt;/span&gt;/schema
&lt;span style=&#34;color:#66d9ef&#34;&gt;$id&lt;/span&gt;: http://example.com/root.json
&lt;span style=&#34;color:#66d9ef&#34;&gt;type&lt;/span&gt;: object
&lt;span style=&#34;color:#66d9ef&#34;&gt;title&lt;/span&gt;: The Root Schema
&lt;span style=&#34;color:#66d9ef&#34;&gt;description&lt;/span&gt;: The root schema is the schema that comprises the entire JSON document.
&lt;span style=&#34;color:#66d9ef&#34;&gt;default&lt;/span&gt;: {}
&lt;span style=&#34;color:#66d9ef&#34;&gt;required&lt;/span&gt;:
  - checked
  - dimensions
  - id
  - name
  - price
  - tags
&lt;span style=&#34;color:#66d9ef&#34;&gt;properties&lt;/span&gt;:
  &lt;span style=&#34;color:#66d9ef&#34;&gt;checked&lt;/span&gt;:
    &lt;span style=&#34;color:#66d9ef&#34;&gt;$id&lt;/span&gt;: &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#39;#/properties/checked&amp;#39;&lt;/span&gt;
    &lt;span style=&#34;color:#66d9ef&#34;&gt;type&lt;/span&gt;: boolean
    &lt;span style=&#34;color:#66d9ef&#34;&gt;title&lt;/span&gt;: The Checked Schema
    &lt;span style=&#34;color:#66d9ef&#34;&gt;description&lt;/span&gt;: An explanation about the purpose of this instance.
    &lt;span style=&#34;color:#66d9ef&#34;&gt;default&lt;/span&gt;: &lt;span style=&#34;color:#66d9ef&#34;&gt;false&lt;/span&gt;
    &lt;span style=&#34;color:#66d9ef&#34;&gt;examples&lt;/span&gt;:
      - &lt;span style=&#34;color:#66d9ef&#34;&gt;false&lt;/span&gt;
  &lt;span style=&#34;color:#66d9ef&#34;&gt;dimensions&lt;/span&gt;:
    &lt;span style=&#34;color:#66d9ef&#34;&gt;$id&lt;/span&gt;: &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#39;#/properties/dimensions&amp;#39;&lt;/span&gt;
    &lt;span style=&#34;color:#66d9ef&#34;&gt;type&lt;/span&gt;: object
    &lt;span style=&#34;color:#66d9ef&#34;&gt;title&lt;/span&gt;: The Dimensions Schema
    &lt;span style=&#34;color:#66d9ef&#34;&gt;description&lt;/span&gt;: An explanation about the purpose of this instance.
    &lt;span style=&#34;color:#66d9ef&#34;&gt;default&lt;/span&gt;: {}
    &lt;span style=&#34;color:#66d9ef&#34;&gt;examples&lt;/span&gt;:
      - &lt;span style=&#34;color:#66d9ef&#34;&gt;height&lt;/span&gt;: &lt;span style=&#34;color:#ae81ff&#34;&gt;10&lt;/span&gt;
        &lt;span style=&#34;color:#66d9ef&#34;&gt;width&lt;/span&gt;: &lt;span style=&#34;color:#ae81ff&#34;&gt;5&lt;/span&gt;
    &lt;span style=&#34;color:#66d9ef&#34;&gt;required&lt;/span&gt;:
      - width
      - height
    &lt;span style=&#34;color:#66d9ef&#34;&gt;properties&lt;/span&gt;:
      &lt;span style=&#34;color:#66d9ef&#34;&gt;width&lt;/span&gt;:
        &lt;span style=&#34;color:#66d9ef&#34;&gt;$id&lt;/span&gt;: &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#39;#/properties/dimensions/properties/width&amp;#39;&lt;/span&gt;
        &lt;span style=&#34;color:#66d9ef&#34;&gt;type&lt;/span&gt;: integer
        &lt;span style=&#34;color:#66d9ef&#34;&gt;title&lt;/span&gt;: The Width Schema
        &lt;span style=&#34;color:#66d9ef&#34;&gt;description&lt;/span&gt;: An explanation about the purpose of this instance.
        &lt;span style=&#34;color:#66d9ef&#34;&gt;default&lt;/span&gt;: &lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;
        &lt;span style=&#34;color:#66d9ef&#34;&gt;examples&lt;/span&gt;:
          - &lt;span style=&#34;color:#ae81ff&#34;&gt;5&lt;/span&gt;
      &lt;span style=&#34;color:#66d9ef&#34;&gt;height&lt;/span&gt;:
        &lt;span style=&#34;color:#66d9ef&#34;&gt;$id&lt;/span&gt;: &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#39;#/properties/dimensions/properties/height&amp;#39;&lt;/span&gt;
        &lt;span style=&#34;color:#66d9ef&#34;&gt;type&lt;/span&gt;: integer
        &lt;span style=&#34;color:#66d9ef&#34;&gt;title&lt;/span&gt;: The Height Schema
        &lt;span style=&#34;color:#66d9ef&#34;&gt;description&lt;/span&gt;: An explanation about the purpose of this instance.
        &lt;span style=&#34;color:#66d9ef&#34;&gt;default&lt;/span&gt;: &lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;
        &lt;span style=&#34;color:#66d9ef&#34;&gt;examples&lt;/span&gt;:
          - &lt;span style=&#34;color:#ae81ff&#34;&gt;10&lt;/span&gt;
  &lt;span style=&#34;color:#66d9ef&#34;&gt;id&lt;/span&gt;:
    &lt;span style=&#34;color:#66d9ef&#34;&gt;$id&lt;/span&gt;: &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#39;#/properties/id&amp;#39;&lt;/span&gt;
    &lt;span style=&#34;color:#66d9ef&#34;&gt;type&lt;/span&gt;: integer
    &lt;span style=&#34;color:#66d9ef&#34;&gt;title&lt;/span&gt;: The Id Schema
    &lt;span style=&#34;color:#66d9ef&#34;&gt;description&lt;/span&gt;: An explanation about the purpose of this instance.
    &lt;span style=&#34;color:#66d9ef&#34;&gt;default&lt;/span&gt;: &lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;
    &lt;span style=&#34;color:#66d9ef&#34;&gt;examples&lt;/span&gt;:
      - &lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt;
  &lt;span style=&#34;color:#66d9ef&#34;&gt;name&lt;/span&gt;:
    &lt;span style=&#34;color:#66d9ef&#34;&gt;$id&lt;/span&gt;: &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#39;#/properties/name&amp;#39;&lt;/span&gt;
    &lt;span style=&#34;color:#66d9ef&#34;&gt;type&lt;/span&gt;: string
    &lt;span style=&#34;color:#66d9ef&#34;&gt;title&lt;/span&gt;: The Name Schema
    &lt;span style=&#34;color:#66d9ef&#34;&gt;description&lt;/span&gt;: An explanation about the purpose of this instance.
    &lt;span style=&#34;color:#66d9ef&#34;&gt;default&lt;/span&gt;: &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#39;&amp;#39;&lt;/span&gt;
    &lt;span style=&#34;color:#66d9ef&#34;&gt;examples&lt;/span&gt;:
      - A green door
  &lt;span style=&#34;color:#66d9ef&#34;&gt;price&lt;/span&gt;:
    &lt;span style=&#34;color:#66d9ef&#34;&gt;$id&lt;/span&gt;: &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#39;#/properties/price&amp;#39;&lt;/span&gt;
    &lt;span style=&#34;color:#66d9ef&#34;&gt;type&lt;/span&gt;: number
    &lt;span style=&#34;color:#66d9ef&#34;&gt;title&lt;/span&gt;: The Price Schema
    &lt;span style=&#34;color:#66d9ef&#34;&gt;description&lt;/span&gt;: An explanation about the purpose of this instance.
    &lt;span style=&#34;color:#66d9ef&#34;&gt;default&lt;/span&gt;: &lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;
    &lt;span style=&#34;color:#66d9ef&#34;&gt;examples&lt;/span&gt;:
      - &lt;span style=&#34;color:#ae81ff&#34;&gt;12.5&lt;/span&gt;
  &lt;span style=&#34;color:#66d9ef&#34;&gt;tags&lt;/span&gt;:
    &lt;span style=&#34;color:#66d9ef&#34;&gt;$id&lt;/span&gt;: &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#39;#/properties/tags&amp;#39;&lt;/span&gt;
    &lt;span style=&#34;color:#66d9ef&#34;&gt;type&lt;/span&gt;: array
    &lt;span style=&#34;color:#66d9ef&#34;&gt;title&lt;/span&gt;: The Tags Schema
    &lt;span style=&#34;color:#66d9ef&#34;&gt;description&lt;/span&gt;: An explanation about the purpose of this instance.
    &lt;span style=&#34;color:#66d9ef&#34;&gt;default&lt;/span&gt;: []
    &lt;span style=&#34;color:#66d9ef&#34;&gt;examples&lt;/span&gt;:
      - - home
        - green
    &lt;span style=&#34;color:#66d9ef&#34;&gt;items&lt;/span&gt;:
      &lt;span style=&#34;color:#66d9ef&#34;&gt;$id&lt;/span&gt;: &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#39;#/properties/tags/items&amp;#39;&lt;/span&gt;
      &lt;span style=&#34;color:#66d9ef&#34;&gt;type&lt;/span&gt;: string
      &lt;span style=&#34;color:#66d9ef&#34;&gt;title&lt;/span&gt;: The Items Schema
      &lt;span style=&#34;color:#66d9ef&#34;&gt;description&lt;/span&gt;: An explanation about the purpose of this instance.
      &lt;span style=&#34;color:#66d9ef&#34;&gt;default&lt;/span&gt;: &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#39;&amp;#39;&lt;/span&gt;
      &lt;span style=&#34;color:#66d9ef&#34;&gt;examples&lt;/span&gt;:
        - home
        - green
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;I learned that &lt;a href=&#34;https://crates.io/crates/serde&#34;&gt;serde&lt;/a&gt; could do this cross-format parsing by reading the
source code of the &lt;a href=&#34;https://github.com/yoshihitoh/refmt&#34;&gt;refmt&lt;/a&gt; project.&lt;/p&gt;
&lt;p&gt;Examples from this post are &lt;a href=&#34;https://github.com/tarquin-the-brave/serde-cross-format&#34;&gt;mastered in github&lt;/a&gt;.&lt;/p&gt;
</description>
     </item>
   
     <item>
       <title>Language Servers Are Cool</title>
       <link>https://tarquin-the-brave.github.io/blog/posts/language-servers-are-cool/</link>
       <pubDate>Sun, 01 Mar 2020 14:56:43 +0000</pubDate>
       
       <guid>https://tarquin-the-brave.github.io/blog/posts/language-servers-are-cool/</guid>
       <description>&lt;p&gt;In slight contrast to my previous post where I espoused the
virtue of code being text and not  relying on developer tooling
to interact with it: language servers are cool.&lt;/p&gt;
&lt;p&gt;They decouple the back end of gaining semantic understanding
of code in a particular language from the editor implementation.
A &lt;a href=&#34;https://langserver.org/&#34;&gt;language server for each language&lt;/a&gt; can be
written, and the editor only needs to integrate the &lt;a href=&#34;https://microsoft.github.io/language-server-protocol/&#34;&gt;language
server protocol&lt;/a&gt; once, to get a host of IDE style features
for each language.&lt;/p&gt;
&lt;p&gt;This is the sort of solution we need to get rid of editor lock
in, and allow text editors to compete to be the best at editing
text.  With language servers, adding language support for an
editor is cheap. Hopefully now developers will start choosing
text editors on the grounds of how good they are at editing text,
rather than the shopping list of languages they support.&lt;/p&gt;
&lt;p&gt;I&amp;rsquo;ve used &lt;a href=&#34;https://rls.booyaa.wtf/#neovim&#34;&gt;rls&lt;/a&gt; for rust, and &lt;a href=&#34;https://github.com/autozimu/LanguageClient-neovim/wiki/Clangd&#34;&gt;clangd&lt;/a&gt; for C++ with the
&lt;a href=&#34;https://github.com/autozimu/LanguageClient-neovim/&#34;&gt;languageClient-neovim&lt;/a&gt; for neovim. I&amp;rsquo;ve been the envy of
colleagues who use Vim-like editors for the impressive language
support, and the envy of colleagues who use IDEs for the superior
text editing&amp;hellip; Not really.  They don&amp;rsquo;t see why I can&amp;rsquo;t just
install their IDE and be done with it. Anyway,language servers
are a great bit of technology.&lt;/p&gt;
</description>
     </item>
   
     <item>
       <title>You Shouldn&#39;t Need an IDE to Read Code</title>
       <link>https://tarquin-the-brave.github.io/blog/posts/ide-ffs/</link>
       <pubDate>Sat, 29 Feb 2020 22:30:09 +0000</pubDate>
       
       <guid>https://tarquin-the-brave.github.io/blog/posts/ide-ffs/</guid>
       <description>&lt;p&gt;This is important.&lt;/p&gt;
&lt;p&gt;Code is &lt;em&gt;read&lt;/em&gt; far more often than it&amp;rsquo;s &lt;em&gt;written&lt;/em&gt;.&lt;/p&gt;
&lt;p&gt;Primarily, it&amp;rsquo;s read through a web GUI.&lt;/p&gt;
&lt;p&gt;You want to read the source code of a library you&amp;rsquo;re using.  Say it&amp;rsquo;s in
Github, you&amp;rsquo;re going to start looking at it through the Github GUI. If you want
to take a deeper look, you might clone the repo and open it in you&amp;rsquo;re editor,
but the vast majority of library code you read will be through a GUI.&lt;/p&gt;
&lt;p&gt;The default medium for reading the changes in a pull request is through a GUI.
Sure, you can pull the branch and open the code up in your editor. When I&amp;rsquo;m
reviewing big changes I do just that. But I shouldn&amp;rsquo;t be required to.&lt;/p&gt;
&lt;p&gt;I&amp;rsquo;ve reviewed code before where I&amp;rsquo;ve made a comment along the line of &amp;ldquo;this
line of code doesn&amp;rsquo;t explain what it&amp;rsquo;s doing&amp;rdquo;, where I&amp;rsquo;ve suggested type
hinting, or renaming things to reflect what&amp;rsquo;s happening, or refactoring the
aggregations that data flows between each line of code so it would make more
sense in the context of the function.  Frustratingly, my comments have received
responses that essentially say: &amp;ldquo;if you were using my editor, it makes perfect
sense&amp;rdquo;.&lt;/p&gt;
&lt;p&gt;My recent concrete example is reviewing code in rust. Rust lets you optionally
type hint in various places, e.g. to specify variable &lt;code&gt;x&lt;/code&gt; as type
&lt;code&gt;SpecificType&lt;/code&gt;:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-rust&#34; data-lang=&#34;rust&#34;&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;let&lt;/span&gt; x: &lt;span style=&#34;color:#a6e22e&#34;&gt;SpecificType&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; get_a_value();
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;There are times where usually optional type declarations are necessary for
compilation because the compiler can&amp;rsquo;t infer the types in your code, but for
the most part, these type hints are optional and can be used by the writer of
the code to check their work or by the reader of the code to understand what&amp;rsquo;s
happening at a type level.&lt;/p&gt;
&lt;p&gt;In rust, types matter. When you&amp;rsquo;re writing and reviewing rust code, you&amp;rsquo;re
thinking about types.  I recently suggested adding some type hinting to some
rust code to make it more readable. I was told, in response, that the type
hinting was unnecessary, and if I was only using the same editor&lt;sup id=&#34;fnref:1&#34;&gt;&lt;a href=&#34;#fn:1&#34; class=&#34;footnote-ref&#34; role=&#34;doc-noteref&#34;&gt;1&lt;/a&gt;&lt;/sup&gt; I could
hover my mouse over the line of code and see the information I need.&lt;/p&gt;
&lt;p&gt;I take issue with both of these statements:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Yes, the code will compile without the type hinting, but code is not there to
satiate compilers, it&amp;rsquo;s there to communicate ideas between people. And,&lt;/li&gt;
&lt;li&gt;What if I don&amp;rsquo;t? Am I required a specific editor with a specific setup in
order to read your code? A community of developers being locked into specific
tooling is not good.  Even if I was using the same editor setup that gives me
all the IDE features, the web GUI I&amp;rsquo;m likely to review code through doesn&amp;rsquo;t.&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;Editor lock-in is a problem.  I&amp;rsquo;ve not developed in Java, but I&amp;rsquo;ve been told
it&amp;rsquo;s very difficult to use without an IDE setup for it.&lt;/p&gt;
&lt;p&gt;Everyone has their dev environment setup in a way that suits them. Code is
there to communicate ideas between developers. Requiring someone installing a
bunch of tooling to be able to read your code is mad.&lt;/p&gt;
&lt;p&gt;Maybe I&amp;rsquo;m biased. I use Vim (neovim). I use some IDE like plugins, but mostly
treat code as text, because that&amp;rsquo;s what it is. And Vim is the best text editor
I&amp;rsquo;ve ever used. Setting up the developer features that IDEs give you out of the
box is possible, but takes time to set up and tune.  So I tend not to have much
in the way of these features, especially for languages that I don&amp;rsquo;t write in
every day.  So maybe I&amp;rsquo;m just trying to avoid the self imposed faff of setting
up my editor so I can read code in the same way someone else does.&lt;/p&gt;
&lt;p&gt;But I don&amp;rsquo;t think so. We don&amp;rsquo;t predominantly read code through editors. We want
to avoid entangling simple tasks like reading code with a load of extra
requirements.  These developer tools are useful, but we shouldn&amp;rsquo;t become
reliant on them.  Code is text.  It should only require a vanilla text editor
to write, and only require something that can render text to read.&lt;/p&gt;
&lt;section class=&#34;footnotes&#34; role=&#34;doc-endnotes&#34;&gt;
&lt;hr&gt;
&lt;ol&gt;
&lt;li id=&#34;fn:1&#34; role=&#34;doc-endnote&#34;&gt;
&lt;p&gt;VSCode appears to be the senior editor for rust.  I don&amp;rsquo;t have a problem
with this.  By the looks of it, it&amp;rsquo;s a fine GUI based editor and everyone
I know who uses it loves it.  It seems its struck a great balance between
having great functionality out of the box, while being easily tuneable and
feel sharp. If I hadn&amp;rsquo;t drank the Vim coolaid, I imagine I&amp;rsquo;d be using it. &lt;a href=&#34;#fnref:1&#34; class=&#34;footnote-backref&#34; role=&#34;doc-backlink&#34;&gt;&amp;#x21a9;&amp;#xfe0e;&lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;/section&gt;
</description>
     </item>
   
     <item>
       <title>Testing Microservices with Mockserver</title>
       <link>https://tarquin-the-brave.github.io/blog/posts/mockserver-dc/</link>
       <pubDate>Tue, 25 Feb 2020 10:07:46 +0000</pubDate>
       
       <guid>https://tarquin-the-brave.github.io/blog/posts/mockserver-dc/</guid>
       <description>&lt;p&gt;&lt;a href=&#34;http://www.mock-server.com/&#34;&gt;Mockserver&lt;/a&gt; is a great piece of tooling that takes a huge amount
of heavy lifting away from testing microservices.&lt;/p&gt;
&lt;p&gt;There&amp;rsquo;s no need to mock out downstream dependencies or client APIs.  There&amp;rsquo;s no
need to write complex test code to synchronously handle the mechanics of
requests going back and forward while also trying to embody some comprehensible
declaration of the designed behaviour.  It does about as much of the mechanics
of testing for you as it&amp;rsquo;s possible for it to do.&lt;/p&gt;
&lt;p&gt;In all honesty, it was my favourite piece of technology I came across in 2019.&lt;/p&gt;
&lt;p&gt;In this post I&amp;rsquo;ll walk through a patten I&amp;rsquo;ve used a few times to quickly get
rather effective testing of a microservice that drives its API.&lt;/p&gt;
&lt;h1 id=&#34;test-setup&#34;&gt;Test Setup&lt;/h1&gt;
&lt;p&gt;The test deployment has three elements:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Your microservice,&lt;/li&gt;
&lt;li&gt;A test driver containing/running your test code, and&lt;/li&gt;
&lt;li&gt;A &lt;a href=&#34;http://www.mock-server.com/&#34;&gt;mockserver&lt;/a&gt; instance.&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;I&amp;rsquo;ve used &lt;a href=&#34;https://docs.docker.com/compose/&#34;&gt;docker-compose&lt;/a&gt; to run the containers and manage the routing
between them, but any container runtime&lt;sup id=&#34;fnref:1&#34;&gt;&lt;a href=&#34;#fn:1&#34; class=&#34;footnote-ref&#34; role=&#34;doc-noteref&#34;&gt;1&lt;/a&gt;&lt;/sup&gt; would do the job.&lt;/p&gt;
&lt;p&gt;&lt;a href=&#34;https://mermaid-js.github.io/mermaid-live-editor/#/edit/eyJjb2RlIjoiZ3JhcGggQlRcbnN1YmdyYXBoIGRvY2tlci1jb21wb3NlXG50ZXN0LXJ1bm5lci0tPnxcInRlc3QtcnVubmVycHJvZ3JhbXMgbW9ja3NlcnZlclwifG1vY2tzZXJ2ZXJcbm1vY2tzZXJ2ZXItLS18XCJtb2Nrc2VydmVyIG1vY2tzIG91dCB0aGUgbWljcm9zZXJ2aWNlIGRlcGVuZGVuY2llcyBhbmQgcmVjb3JkcyBtZXNzYWdlc1wifGEobWljcm9zZXJ2aWNlKVxudGVzdC1ydW5uZXItLT58XCJ0ZXN0LXJ1bm5lciBraWNrcyBtaWNyb3NlcnZpY2UgQVBJIHRvIHN0YXJ0IHRlc3RcInxhKG1pY3Jvc2VydmljZSlcbmVuZFxuXHRcdCIsIm1lcm1haWQiOnsidGhlbWUiOiJkZWZhdWx0In0sInVwZGF0ZUVkaXRvciI6ZmFsc2V9&#34;&gt;&lt;img src=&#34;https://mermaid.ink/img/eyJjb2RlIjoiZ3JhcGggQlRcbnN1YmdyYXBoIGRvY2tlci1jb21wb3NlXG50ZXN0LXJ1bm5lci0tPnxcInRlc3QtcnVubmVycHJvZ3JhbXMgbW9ja3NlcnZlclwifG1vY2tzZXJ2ZXJcbm1vY2tzZXJ2ZXItLS18XCJtb2Nrc2VydmVyIG1vY2tzIG91dCB0aGUgbWljcm9zZXJ2aWNlIGRlcGVuZGVuY2llcyBhbmQgcmVjb3JkcyBtZXNzYWdlc1wifGEobWljcm9zZXJ2aWNlKVxudGVzdC1ydW5uZXItLT58XCJ0ZXN0LXJ1bm5lciBraWNrcyBtaWNyb3NlcnZpY2UgQVBJIHRvIHN0YXJ0IHRlc3RcInxhKG1pY3Jvc2VydmljZSlcbmVuZFxuXHRcdCIsIm1lcm1haWQiOnsidGhlbWUiOiJkZWZhdWx0In0sInVwZGF0ZUVkaXRvciI6ZmFsc2V9&#34; alt=&#34;&#34;&gt;&lt;/a&gt;&lt;/p&gt;
&lt;h2 id=&#34;mockserver&#34;&gt;Mockserver&lt;/h2&gt;
&lt;p&gt;The key element here is &lt;a href=&#34;http://www.mock-server.com/&#34;&gt;mockserver&lt;/a&gt;. It looks after the mechanics
of mocking out the dependencies of a service.  It&amp;rsquo;s controlled by your test
code over its API. You tell it what messages to expect an how to respond to
them ahead of time. It records what messages have come and gone during the
test.  Your tests can send a request to verify the expectations have been met
or partially met.&lt;/p&gt;
&lt;p&gt;The result is that each test case ends up looking like:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;A bunch of requests to &lt;a href=&#34;http://www.mock-server.com/&#34;&gt;mockserver&lt;/a&gt;, via the client you&amp;rsquo;ve
chosen, or generated from the &lt;a href=&#34;https://app.swaggerhub.com/apis/jamesdbloom/mock-server-openapi/5.0.x&#34;&gt;openAPI spec&lt;/a&gt;, to establish the
requests that you expect to see and how to respond to each,&lt;/li&gt;
&lt;li&gt;A call to an endpoint on your microservice&amp;rsquo;s API, and&lt;/li&gt;
&lt;li&gt;A call to &lt;a href=&#34;http://www.mock-server.com/&#34;&gt;mockserver&lt;/a&gt; to verify that the expected messages were
received.&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;Mockserver takes away the need to define in the test code all the mechanics
around what messages should be where, when. You define what to expect upfront,
&lt;a href=&#34;http://www.mock-server.com/&#34;&gt;mockserver&lt;/a&gt; records if there&amp;rsquo;s anything the matter with the
messages, and at the end, you can ask it whether the expectations were met.&lt;/p&gt;
&lt;h2 id=&#34;the-test-runner&#34;&gt;The Test Runner&lt;/h2&gt;
&lt;p&gt;We run the test code in its own container to make it easy to control the
environment and to make networking easier when we introduce
&lt;a href=&#34;https://docs.docker.com/compose/&#34;&gt;docker-compose&lt;/a&gt; to manage the setup.&lt;/p&gt;
&lt;p&gt;We define a &lt;code&gt;Dockerfile&lt;/code&gt; for our test runner that builds a container with the
test code and its dependencies. docker-compose can then rebuild the test
container and run the tests in one &lt;a href=&#34;#running-the-tests&#34;&gt;command&lt;/a&gt;.&lt;/p&gt;
&lt;p&gt;A result of using &lt;a href=&#34;http://www.mock-server.com/&#34;&gt;mockserver&lt;/a&gt;, and this test setup, is that the
test code is fairly minimal and there&amp;rsquo;s no real &amp;ldquo;test framework&amp;rdquo; required.
Once you have a &lt;a href=&#34;http://www.mock-server.com/&#34;&gt;mockserver&lt;/a&gt; client library&lt;sup id=&#34;fnref:2&#34;&gt;&lt;a href=&#34;#fn:2&#34; class=&#34;footnote-ref&#34; role=&#34;doc-noteref&#34;&gt;2&lt;/a&gt;&lt;/sup&gt;, and a client
library for your microservice (or decide that defining the requests to kick off
a test on the fly) there&amp;rsquo;s not much more to the tests.&lt;/p&gt;
&lt;p&gt;I&amp;rsquo;ve written the code for this test runner in Python using &lt;a href=&#34;https://docs.pytest.org/en/latest/&#34;&gt;pytest&lt;/a&gt;.
It worked quite well.  But, as the test code only makes a series of requests,
it&amp;rsquo;s not important.&lt;/p&gt;
&lt;h2 id=&#34;your-microservice&#34;&gt;Your Microservice&lt;/h2&gt;
&lt;p&gt;Configure your microservice with &lt;a href=&#34;http://www.mock-server.com/&#34;&gt;mockserver&lt;/a&gt; as the target for all
downstream traffic.&lt;/p&gt;
&lt;p&gt;The URL of &lt;a href=&#34;http://www.mock-server.com/&#34;&gt;mockserver&lt;/a&gt; corresponds to the service name and the
port it exposes, defined in the &lt;a href=&#34;#docker-compose-example&#34;&gt;docker-compose file&lt;/a&gt;.&lt;/p&gt;
&lt;h1 id=&#34;docker-compose-example&#34;&gt;Docker Compose Example&lt;/h1&gt;
&lt;p&gt;We have a docker-compose file: &lt;code&gt;docker-compose.yml&lt;/code&gt;&lt;/p&gt;
&lt;script type=&#34;application/javascript&#34; src=&#34;https://gist.github.com/tarquin-the-brave/7a2d813015d049fbe40e3723b0795be4.js?file=docker-compose.yml&#34;&gt;&lt;/script&gt;

&lt;p&gt;In this example, under &lt;code&gt;services:&lt;/code&gt; there&amp;rsquo;s an entry for each of the containers
in this setup.&lt;/p&gt;
&lt;p&gt;Docker compose will route the containers together by giving them a domain name
for the name under &lt;code&gt;services:&lt;/code&gt;, e.g. the microservice can route to the
&lt;a href=&#34;http://www.mock-server.com/&#34;&gt;mockserver&lt;/a&gt; by sending requests to the domain name &lt;code&gt;mockdeps&lt;/code&gt;. The
test runner routes to the microservice by sending requests to the domain name
&lt;code&gt;microservice&lt;/code&gt;.&lt;/p&gt;
&lt;h2 id=&#34;the-test-runner-1&#34;&gt;The Test Runner&lt;/h2&gt;
&lt;p&gt;&lt;code&gt;test:&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;In our example the &lt;code&gt;Dockerfile&lt;/code&gt; defining the test runner container is found
under directory &lt;code&gt;fv/&lt;/code&gt;, along with the test code and everything else needed to
build the test runner.&lt;/p&gt;
&lt;p&gt;We define the command to run the tests and allow for arguments to the test
command with &lt;code&gt;${TEST_ARGS}&lt;/code&gt;.&lt;/p&gt;
&lt;h2 id=&#34;your-microservice-1&#34;&gt;Your Microservice&lt;/h2&gt;
&lt;p&gt;&lt;code&gt;microservice:&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;For this example:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;We allow the image to test to be configured by a variable, defaulting to
&lt;code&gt;x:latest&lt;/code&gt;.&lt;/li&gt;
&lt;li&gt;We set the &lt;code&gt;LOG_LEVEL&lt;/code&gt; environment variable in the microservice container.&lt;/li&gt;
&lt;li&gt;We mount in a config file with necessary config, listing the downstream
dependencies that we&amp;rsquo;re mocking out with &lt;a href=&#34;http://www.mock-server.com/&#34;&gt;mockserver&lt;/a&gt; as being at
&lt;code&gt;mockdeps:12345&lt;/code&gt;.&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;If we wanted to automate rebuilding the microservice for testing, we could
define a &lt;code&gt;Dockerfile&lt;/code&gt; for the microservice that can build it from source,
perhaps using the &lt;a href=&#34;https://docs.docker.com/develop/develop-images/multistage-build/&#34;&gt;multistage builder pattern&lt;/a&gt;, and include and entry
like the one for &lt;a href=&#34;#the-test-runner-2&#34;&gt;the test runner&lt;/a&gt; rather than specifying a
tag for an already built image.&lt;/p&gt;
&lt;h2 id=&#34;mockserver-1&#34;&gt;Mockserver&lt;/h2&gt;
&lt;p&gt;&lt;code&gt;mockdeps:&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;The &lt;a href=&#34;http://www.mock-server.com/&#34;&gt;mockserver&lt;/a&gt; entry exposes a port and passes that as an
argument to &lt;a href=&#34;http://www.mock-server.com/&#34;&gt;mockserver&lt;/a&gt;.&lt;/p&gt;
&lt;p&gt;You can copy this section verbatim, updating the &lt;a href=&#34;https://hub.docker.com/r/jamesdbloom/mockserver/tags&#34;&gt;mockserver version&lt;/a&gt;.&lt;/p&gt;
&lt;h1 id=&#34;running-the-tests&#34;&gt;Running The Tests&lt;/h1&gt;
&lt;p&gt;With this setup, and our microservice container built (and tagged as &lt;code&gt;x:test&lt;/code&gt;),
we can spin up the microservice and the mockserver with:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;$ IMAGE&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;x:test&amp;#34;&lt;/span&gt; docker-compose up -d mockdeps microservice
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;To run the tests:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;$ docker-compose up --build test
...
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;The &lt;code&gt;--build&lt;/code&gt; parameter ensures &lt;a href=&#34;#the-test-runner&#34;&gt;the test runner&lt;/a&gt; is rebuilt,
so if we&amp;rsquo;ve edited our test code, the new test code will be run.&lt;/p&gt;
&lt;p&gt;To pass arguments to our command that runs the tests, e.g. to only run a
specific test:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;$ TEST_ARGS&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;-t specific_test_1&amp;#34;&lt;/span&gt; docker-compose up --build test
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;Perhaps we&amp;rsquo;ve forgotten the CLI of the tool that runs our tests:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;$ TEST_ARGS&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;--help&amp;#34;&lt;/span&gt; docker-compose up --build test
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;To tear down the whole test setup:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;$ docker-compose down
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h1 id=&#34;summary&#34;&gt;Summary&lt;/h1&gt;
&lt;p&gt;So it&amp;rsquo;s as simple as that.  Don&amp;rsquo;t write complicated request handling test code,
and code that painstakingly mocks out all downstream dependencies, let
&lt;a href=&#34;http://www.mock-server.com/&#34;&gt;mockserver&lt;/a&gt; do that heavy lifting for you. Using
&lt;a href=&#34;https://docs.docker.com/compose/&#34;&gt;docker-compose&lt;/a&gt; you can rebuild your tests (and perhaps also your
microservice) and run the tests with a couple of commands.  Iterate fast and
test your microservice by driving its API.  At the end of the day, it&amp;rsquo;s the API
that matters.&lt;/p&gt;
&lt;section class=&#34;footnotes&#34; role=&#34;doc-endnotes&#34;&gt;
&lt;hr&gt;
&lt;ol&gt;
&lt;li id=&#34;fn:1&#34; role=&#34;doc-endnote&#34;&gt;
&lt;p&gt;You could do this in &lt;a href=&#34;https://kubernetes.io/&#34;&gt;kubernetes&lt;/a&gt;. There are
miniature kubernetes implementations that you can install on your dev machine
or run in CI: &lt;a href=&#34;https://github.com/kubernetes/minikube&#34;&gt;minikube&lt;/a&gt;,
&lt;a href=&#34;https://k3s.io/&#34;&gt;k3s&lt;/a&gt;, &lt;a href=&#34;https://microk8s.io/&#34;&gt;microk8s&lt;/a&gt;. You could put the
&lt;a href=&#34;#test-setup&#34;&gt;elements&lt;/a&gt; in
&lt;a href=&#34;https://kubernetes.io/docs/concepts/workloads/pods/pod-overview/&#34;&gt;Pods&lt;/a&gt; or
&lt;a href=&#34;https://kubernetes.io/docs/concepts/workloads/controllers/deployment/&#34;&gt;Deployments&lt;/a&gt;
and route them to each other via
&lt;a href=&#34;https://kubernetes.io/docs/concepts/services-networking/service/&#34;&gt;Services&lt;/a&gt;.
None of the test code would have to change. To me that seemed more effort
than writing a short docker-compose file for this small setup.  Mockserver
published &lt;a href=&#34;http://www.mock-server.com/where/kubernetes.html&#34;&gt;a helm chart&lt;/a&gt;
which could be useful.  Mockserver could be used in a larger test setup on a
persistent kubernetes cluster. &lt;a href=&#34;#fnref:1&#34; class=&#34;footnote-backref&#34; role=&#34;doc-backlink&#34;&gt;&amp;#x21a9;&amp;#xfe0e;&lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li id=&#34;fn:2&#34; role=&#34;doc-endnote&#34;&gt;
&lt;p&gt;There&amp;rsquo;s plenty of client libraries out there for mockserver.  &lt;a href=&#34;https://pypi.org/search/?q=mockserver&#34;&gt;Python has
a few&lt;/a&gt;, I used a couple and they
didn&amp;rsquo;t actually work, so I had to patch them.  I&amp;rsquo;d recommending generating
you&amp;rsquo;re own from mockserver&amp;rsquo;s &lt;a href=&#34;https://app.swaggerhub.com/apis/jamesdbloom/mock-server-openapi/5.0.x&#34;&gt;openAPI
spec&lt;/a&gt;
using &lt;a href=&#34;https://github.com/OpenAPITools/openapi-generator&#34;&gt;openAPI Generator&lt;/a&gt;. &lt;a href=&#34;#fnref:2&#34; class=&#34;footnote-backref&#34; role=&#34;doc-backlink&#34;&gt;&amp;#x21a9;&amp;#xfe0e;&lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;/section&gt;
</description>
     </item>
   
 </channel>
</rss>
